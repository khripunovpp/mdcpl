<script>

  window.isMobile = function () {
    return window.matchMedia("only screen and (max-width: 990px)").matches;
  };
  window.libLoaded = function () {
    console.log('libLoaded');

    var lazy = $('.lazy').Lazy({
      effect: 'fadeIn',
      effectTime: 500,
      threshold: 0,
      afterLoad: function (element) {
        $(element).closest('.lazy-wrapper').addClass('is-loaded');
      },
    });

    var teamSplide = new Splide('#team-slider', {
      type: 'loop',
      perPage: 5,
      arrowPath: '',
      perMove: 1,
      lazyLoad: 'nearby',
      breakpoints: {
        1200: {
          perPage: 4,
        },
        990: {
          destroy: true,
        },
      }
    });
    teamSplide.mount();
    var reviewsSplide = new Splide('#reviews-slider', {
      type: 'loop',
      perPage: 2,
      arrowPath: '',
      perMove: 1,
      lazyLoad: 'nearby',
      gap: 30,
      breakpoints: {
        1100: {
          perPage: 1,
        },
      }
    });
    reviewsSplide.mount();
    reviewsSplide.on('move', function (newIndex, prevIndex) {
      // find all expaned items and close them
      $('.expandable.expanded').find('.expandable__button').trigger('click');
      // updateHeight(newIndex);
    });


    function updateHeight(newIndex) {
      var isMob = window.matchMedia("only screen and (max-width: 1100px)").matches;
      if (!isMob) return;
      console.log(teamSplide);
      let slide = reviewsSplide.Components.Slides.getAt(typeof (newIndex) == 'number' ? newIndex : reviewsSplide.index).slide;
      console.log({slide})
      var h = slide.querySelector('.review-card').offsetHeight;

      slide.parentElement.parentElement.style.height = (h ? h : 80) + 'px';
    }

    var slidingHover = $('.team-slider__slidingHover');
    var scale = 0.9;
    slidingHover.css({
      transform: 'scale(' + scale + ')',
    });
    var lastTranslate = 0;
    $('.team-slider__item').on('mouseenter', function (e) {
      if (window.isMobile()) return;
      var el = $(e.target).closest('.team-slider__item');
      console.log(el, el.hasClass('is-visible'));
      if (!el.hasClass('is-visible')) return;
      var elOffset = el.offset();
      var parentOffset = el.closest('.splide__track').offset();
      var positionInsideParent = elOffset.left - parentOffset.left;
      console.log({positionInsideParent, parentOffset, elOffset});
      lastTranslate = positionInsideParent;
      slidingHover.css({
        'transform': 'translateX(' + lastTranslate + 'px) scale(1)',
        opacity: 1,
      });
    });
    $('.splide__track').on('mouseleave', function (e) {
      if (window.isMobile()) return;
      slidingHover.css({
        opacity: 0,
        transform: 'translateX(' + lastTranslate + 'px)' + ' scale(' + scale + ')',
      });
    });
    $(window).on('resize', function () {
      slidingHover.css({
        opacity: 0,
      });
    });
    //
    //  var stickySidebar = new StickySidebar('.sticky-block', {
    //   // bottomSpacing: 20,
    //   containerSelector: '.services-widget__desktopScrollerListContainer',
    //   innerWrapperSelector: '.services-widget__desktopScrollerListContainer-list',
    // });

    // var sticky = new Sticky('.sticky-block');
  }

  //listen all errors
  window.onerror = function (message, url, linenumber) {
    alert('JavaScript error: ' + message + ' on line ' + linenumber + ' for ' + url);
  }
</script>